from pathlib import Path
from xml.etree import ElementTree

REFPAGES = Path("/Applications/Studio/Max.app/Contents/Resources/C74/docs/refpages")
JIT_REF = REFPAGES / 'jit-ref'
MAX_REF = REFPAGES / 'max-ref'
MSP_REF = REFPAGES / 'msp-ref'
M4L_REF = REFPAGES / 'm4l-ref'

MAX_REF_FILE = [
    'abs',
    'absolutepath',
    'accum',
    'acos',
    'acosh',
    'active',
    'anal',
    'append',
    'array',
    'array.change',
    'array.compare',
    'array.concat',
    'array.every',
    'array.expr',
    'array.fill',
    'array.filter',
    'array.flatten',
    'array.foreach',
    'array.frombuffer',
    'array.group',
    'array.index',
    'array.indexmap',
    'array.indexof',
    'array.insert',
    'array.iter',
    'array.join',
    'array.length',
    'array.map',
    'array.max',
    'array.mean',
    'array.median',
    'array.min',
    'array.mode',
    'array.pop',
    'array.push',
    'array.random',
    'array.reduce',
    'array.remove',
    'array.reverse',
    'array.rotate',
    'array.routepass',
    'array.scramble',
    'array.sect',
    'array.shift',
    'array.slice',
    'array.some',
    'array.sort',
    'array.split',
    'array.stddev',
    'array.stream',
    'array.subarray',
    'array.thin',
    'array.tobuffer',
    'array.tolist',
    'array.tostring',
    'array.tosymbol',
    'array.tuplewise',
    'array.union',
    'array.unique',
    'array.unshift',
    'array.wrap',
    'asin',
    'asinh',
    'atan',
    'atan2',
    'atanh',
    'atodb',
    'atoi',
    'attrui',
    'autopattr',
    'bag',
    'bangbang',
    'bendin',
    'bendout',
    'bgcolor',
    'bitand',
    'bitor',
    'bline',
    'bondo',
    'borax',
    'bpatcher',
    'bucket',
    'buddy',
    'button',
    'capture',
    'cartopol',
    'change',
    'chooser',
    'clip',
    'clocker',
    'closebang',
    'coll',
    'coll.codebox',
    'colorpicker',
    'combine',
    'comment',
    'conformpath',
    'console',
    'cos',
    'cosh',
    'counter',
    'cpuclock',
    'crosspatch',
    'ctlin',
    'ctlout',
    'cycle',
    'date',
    'dbtoa',
    'decide',
    'decode',
    'defer',
    'deferlow',
    'delay',
    'detonate',
    'dial',
    'dialog',
    'dict',
    'dict.codebox',
    'dict.compare',
    'dict.deserialize',
    'dict.group',
    'dict.iter',
    'dict.join',
    'dict.pack',
    'dict.print',
    'dict.route',
    'dict.serialize',
    'dict.slice',
    'dict.strip',
    'dict.unpack',
    'dict.view',
    'div',
    'dropfile',
    'drunk',
    'dsp',
    'equals',
    'error',
    'expr',
    'filedate',
    'filein',
    'filepath',
    'filewatch',
    'float',
    'flonum',
    'flush',
    'folder',
    'follow',
    'fontlist',
    'forward',
    'fpic',
    'freebang',
    'fromsymbol',
    'fswap',
    'ftom',
    'funbuff',
    'function',
    'funnel',
    'gamepad',
    'gate',
    'gestalt',
    'getattr',
    'grab',
    'greaterthan',
    'greaterthaneq',
    'gswitch',
    'gswitch2',
    'hi',
    'hid',
    'hint',
    'histo',
    'hover',
    'if',
    'images',
    'imovie',
    'incdec',
    'inlet',
    'int',
    'itable',
    'iter',
    'itoa',
    'jbox',
    'jit.cellblock',
    'jit_kernel',
    'join',
    'js',
    'jstrigger',
    'jsui',
    'jweb',
    'jweb~',
    'key',
    'keyup',
    'kslider',
    'lcd',
    'led',
    'lessthan',
    'lessthaneq',
    'line',
    'linedrive',
    'listfunnel',
    'loadbang',
    'loadmess',
    'logand',
    'logor',
    'makenote',
    'mappings',
    'match',
    'matrix',
    'matrixctrl',
    'max',
    'maximum',
    'maxurl',
    'mc.function',
    'mc.getattr',
    'mc.line',
    'mean',
    'menubar',
    'message',
    'metro',
    'midiflush',
    'midiformat',
    'midiin',
    'midiinfo',
    'midiout',
    'midiparse',
    'minimum',
    'minus',
    'modifiers',
    'modulo',
    'mousefilter',
    'mousestate',
    'movie',
    'mpeconfig',
    'mpeformat',
    'mpeparse',
    'mtof',
    'mtr',
    'multirange',
    'multislider',
    'mxj',
    'next',
    'nodes',
    'notein',
    'noteout',
    'notequals',
    'nrpnin',
    'nrpnout',
    'nslider',
    'number',
    'numkey',
    'offer',
    'onebang',
    'onecopy',
    'opendialog',
    'osc.codebox',
    'outlet',
    'pack',
    'pak',
    'panel',
    'param',
    'param.osc',
    'past',
    'patcher',
    'patcherargs',
    'pattr',
    'pattrforward',
    'pattrhub',
    'pattrmarker',
    'pattrstorage',
    'pcontrol',
    'peak',
    'pgmin',
    'pgmout',
    'pictctrl',
    'pictslider',
    'pipe',
    'playbar',
    'plus',
    'poltocar',
    'poly',
    'polyin',
    'polymidiin',
    'polyout',
    'pong',
    'pow',
    'prepend',
    'preset',
    'print',
    'prob',
    'project',
    'pv',
    'pvar',
    'qlim',
    'qlist',
    'qmetro',
    'quickthresh',
    'radiogroup',
    'random',
    'rdiv',
    'receive',
    'regexp',
    'relativepath',
    'repl',
    'rminus',
    'round',
    'route',
    'routepass',
    'router',
    'rpnin',
    'rpnout',
    'rslider',
    'rtin',
    'savebang',
    'savedialog',
    'scale',
    'schedule',
    'screensize',
    'select',
    'send',
    'seq',
    'serial',
    'setclock',
    'shiftleft',
    'shiftright',
    'sin',
    'sinh',
    'slide',
    'slider',
    'speedlim',
    'spell',
    'split',
    'spray',
    'sprintf',
    'sqrt',
    'standalone',
    'string',
    'string.append',
    'string.bytes',
    'string.change',
    'string.compare',
    'string.concat',
    'string.contains',
    'string.endswith',
    'string.frombytes',
    'string.fromsymlist',
    'string.fromutf8',
    'string.index',
    'string.indexof',
    'string.iter',
    'string.length',
    'string.passcmp',
    'string.prepend',
    'string.regexp',
    'string.remove',
    'string.replace',
    'string.replaceall',
    'string.reverse',
    'string.rotate',
    'string.slice',
    'string.split',
    'string.sprintf',
    'string.startswith',
    'string.substring',
    'string.toarray',
    'string.tolist',
    'string.tolower',
    'string.tosymbol',
    'string.toupper',
    'string.trim',
    'string.trimend',
    'string.trimstart',
    'string.utf8',
    'stripnote',
    'strippath',
    'substitute',
    'suckah',
    'suspend',
    'sustain',
    'swap',
    'swatch',
    'switch',
    'sxformat',
    'sysexin',
    'tab',
    'table',
    'tan',
    'tanh',
    'tempo',
    'text',
    'textbutton',
    'textedit',
    'themecolor',
    'thispatcher',
    'threadcheck',
    'thresh',
    'timepoint',
    'timer',
    'times',
    'togedge',
    'toggle',
    'tosymbol',
    'touchin',
    'touchout',
    'translate',
    'transport',
    'trigger',
    'trough',
    'ubutton',
    'udpreceive',
    'udpsend',
    'umenu',
    'universal',
    'unjoin',
    'unpack',
    'urn',
    'uzi',
    'v8',
    'v8.codebox',
    'v8ui',
    'value',
    'vdp',
    'vexpr',
    'vstscan',
    'when',
    'xbendin',
    'xbendout',
    'xctlin',
    'xctlout',
    'xmidiin',
    'xnotein',
    'xnoteout',
    'zl',
    'zl.change',
    'zl.compare',
    'zl.delace',
    'zl.ecils',
    'zl.filter',
    'zl.group',
    'zl.indexmap',
    'zl.iter',
    'zl.join',
    'zl.lace',
    'zl.len',
    'zl.lookup',
    'zl.median',
    'zl.mth',
    'zl.nth',
    'zl.queue',
    'zl.reg',
    'zl.rev',
    'zl.rot',
    'zl.scramble',
    'zl.sect',
    'zl.slice',
    'zl.sort',
    'zl.stack',
    'zl.stream',
    'zl.sub',
    'zl.sum',
    'zl.swap',
    'zl.thin',
    'zl.union',
    'zl.unique',
    'zmap',
]

MSP_REF_FILES = [
    '2d.wave~',
    'abs~',
    'acosh~',
    'acos~',
    'adc~',
    'adoutput~',
    'adsr~',
    'adstatus',
    'allpass~',
    'amxd~',
    'amxd~_ref.xml',
    'asinh~',
    'asin~',
    'atan2~',
    'atanh~',
    'atan~',
    'atodb~',
    'average~',
    'avg~',
    'begin~',
    'biquad~',
    'bitand~',
    'bitnot~',
    'bitor~',
    'bitsafe~',
    'bitshift~',
    'bitxor~',
    'buffer~',
    'buffir~',
    'capture~',
    'cartopol~',
    'cascade~',
    'change~',
    'click~',
    'clip~',
    'comb~',
    'cosh~',
    'cosx~',
    'cos~',
    'count~',
    'cross~',
    'curve~',
    'cycle~',
    'dac~',
    'dbtoa~',
    'degrade~',
    'delay~',
    'deltaclip~',
    'delta~',
    'div~',
    'downsamp~',
    'dspstate~',
    'dsptime~',
    'edge~',
    'equals~',
    'ezadc~',
    'ezdac~',
    'fbinshift~',
    'fffb~',
    'fftinfo~',
    'fftin~',
    'fftout~',
    'fft~',
    'filtercoeff~',
    'filterdesign',
    'filterdetail',
    'filtergraph~',
    'frameaccum~',
    'frameaverage~',
    'framedelta~',
    'framesmooth~',
    'framesnap~',
    'frame~',
    'freqshift~',
    'ftom~',
    'fzero~',
    'gain~',
    'gate~',
    'gen',
    'gen.codebox~',
    'gen~',
    'gizmo~',
    'greaterthaneq~',
    'greaterthan~',
    'gridmeter~',
    'groove~',
    'hilbert~',
    'ifft~',
    'in',
    'index~',
    'info~',
    'in~',
    'ioscbank~',
    'kink~',
    'lessthaneq~',
    'lessthan~',
    'levelmeter~',
    'limi~',
    'line~',
    'log~',
    'lookup~',
    'lores~',
    'loudness~',
    'matrix~',
    'maximum~',
    'mc.2d.wave~',
    'mc.abs~',
    'mc.acosh~',
    'mc.acos~',
    'mc.adc~',
    'mc.adsr~',
    'mc.allpass~',
    'mc.amxd~',
    'mc.apply~',
    'mc.asinh~',
    'mc.asin~',
    'mc.assign',
    'mc.atan2~',
    'mc.atanh~',
    'mc.atan~',
    'mc.atodb~',
    'mc.average~',
    'mc.avg~',
    'mc.bands~',
    'mc.biquad~',
    'mc.bitand~',
    'mc.bitnot~',
    'mc.bitor~',
    'mc.bitsafe~',
    'mc.bitxor~',
    'mc.buffir~',
    'mc.cartopol~',
    'mc.cascade~',
    'mc.cell',
    'mc.change~',
    'mc.channelcount~',
    'mc.chord~',
    'mc.click~',
    'mc.clip~',
    'mc.combine~',
    'mc.comb~',
    'mc.cosh~',
    'mc.cosx~',
    'mc.cos~',
    'mc.count~',
    'mc.cross~',
    'mc.curve~',
    'mc.cycle~',
    'mc.dac~',
    'mc.dbtoa~',
    'mc.degrade~',
    'mc.deinterleave~',
    'mc.delay~',
    'mc.deltaclip~',
    'mc.delta~',
    'mc.div~',
    'mc.downsamp~',
    'mc.dup~',
    'mc.edge~',
    'mc.equals~',
    'mc.evolve~',
    'mc.ezadc~',
    'mc.ezdac~',
    'mc.fffb~',
    'mc.fft~',
    'mc.filtercoeff~',
    'mc.frameaccum~',
    'mc.frameaverage~',
    'mc.framedelta~',
    'mc.framesmooth~',
    'mc.freqshift~',
    'mc.ftom~',
    'mc.fzero~',
    'mc.gain~',
    'mc.gate~',
    'mc.gen',
    'mc.generate~',
    'mc.gen~',
    'mc.gradient~',
    'mc.greaterthaneq~',
    'mc.greaterthan~',
    'mc.groove~',
    'mc.hilbert~',
    'mc.ifft~',
    'mc.index~',
    'mc.interleave~',
    'mc.in~',
    'mc.kink~',
    'mc.lessthaneq~',
    'mc.lessthan~',
    'mc.limi~',
    'mc.line~',
    'mc.list~',
    'mc.log~',
    'mc.lookup~',
    'mc.lores~',
    'mc.loudness~',
    'mc.makelist',
    'mc.matrix~',
    'mc.maximum~',
    'mc.midiplayer~',
    'mc.miditarget',
    'mc.minimum~',
    'mc.minmax~',
    'mc.minus~',
    'mc.mixdown~',
    'mc.modulo~',
    'mc.mstosamps~',
    'mc.mtof~',
    'mc.noise~',
    'mc.normalize~',
    'mc.noteallocator~',
    'mc.notequals~',
    'mc.number~',
    'mc.omx.4band~',
    'mc.omx.5band~',
    'mc.omx.comp~',
    'mc.omx.peaklim~',
    'mc.onepole~',
    'mc.op~',
    'mc.out~',
    'mc.overdrive~',
    'mc.pack~',
    'mc.pattern~',
    'mc.peakamp~',
    'mc.peek~',
    'mc.pfft~',
    'mc.phasegroove~',
    'mc.phaseshift~',
    'mc.phasewrap~',
    'mc.phasor~',
    'mc.pink~',
    'mc.pitchshift~',
    'mc.playlist~',
    'mc.play~',
    'mc.plusequals~',
    'mc.plus~',
    'mc.poltocar~',
    'mc.poly~',
    'mc.pong~',
    'mc.pow~',
    'mc.rampsmooth~',
    'mc.ramp~',
    'mc.rand~',
    'mc.range~',
    'mc.rate~',
    'mc.rdiv~',
    'mc.receive~',
    'mc.record~',
    'mc.rect~',
    'mc.resize~',
    'mc.reson~',
    'mc.retune~',
    'mc.rminus~',
    'mc.round~',
    'mc.route',
    'mc.sah~',
    'mc.sampstoms~',
    'mc.sash~',
    'mc.saw~',
    'mc.scale~',
    'mc.selector~',
    'mc.send~',
    'mc.separate~',
    'mc.seq~',
    'mc.sfizz~',
    'mc.sfplay~',
    'mc.sfrecord~',
    'mc.shape~',
    'mc.sig~',
    'mc.sinh~',
    'mc.sinx~',
    'mc.slide~',
    'mc.snapshot~',
    'mc.snowfall~',
    'mc.snowphasor~',
    'mc.spike~',
    'mc.sqrt~',
    'mc.stash~',
    'mc.stereo~',
    'mc.stutter~',
    'mc.subdiv~',
    'mc.svf~',
    'mc.swing~',
    'mc.sync~',
    'mc.table~',
    'mc.tanh~',
    'mc.tanx~',
    'mc.tapin~',
    'mc.tapout~',
    'mc.target',
    'mc.targetlist',
    'mc.teeth~',
    'mc.thresh~',
    'mc.times~',
    'mc.train~',
    'mc.transpose~',
    'mc.trapezoid~',
    'mc.triangle~',
    'mc.tri~',
    'mc.trunc~',
    'mc.twist~',
    'mc.unpack~',
    'mc.updown~',
    'mc.vectral~',
    'mc.voiceallocator~',
    'mc.vst~',
    'mc.wave~',
    'mc.what~',
    'mc.where~',
    'mc.zerox~',
    'mc.zigzag~',
    'mcs.2d.wave~',
    'mcs.amxd~',
    'mcs.fffb~',
    'mcs.gate~',
    'mcs.gen~',
    'mcs.groove~',
    'mcs.limi~',
    'mcs.matrix~',
    'mcs.play~',
    'mcs.poly~',
    'mcs.selector~',
    'mcs.sig~',
    'mcs.tapout~',
    'mcs.vst~',
    'mcs.wave~',
    'mcwrapper-group',
    'meter~',
    'minimum~',
    'minmax~',
    'minus~',
    'modulo~',
    'mstosamps~',
    'mtof~',
    'mute~',
    'mxj~',
    'noise~',
    'normalize~',
    'notequals~',
    'number~',
    'omx.4band~',
    'omx.5band~',
    'omx.comp~',
    'omx.peaklim~',
    'onepole~',
    'oscbank~',
    'out',
    'out~',
    'overdrive~',
    'pass~',
    'peakamp~',
    'peek~',
    'pfft~',
    'phasegroove~',
    'phaseshift~',
    'phasewrap~',
    'phasor~',
    'pink~',
    'pitchshift~',
    'playlist~',
    'play~',
    'plot~',
    'plugin~',
    'plugout~',
    'plugphasor~',
    'plugreceive~',
    'plugsend~',
    'plugsync~',
    'plusequals~',
    'plus~',
    'poke~',
    'poltocar~',
    'polybuffer~',
    'poly~',
    'pong~',
    'pow~',
    'rampsmooth~',
    'ramp~',
    'rand~',
    'rate~',
    'rdiv~',
    'receive~',
    'record~',
    'rect~',
    'reson~',
    'retune~',
    'rminus~',
    'round~',
    'sah~',
    'sampstoms~',
    'sash~',
    'saw~',
    'scale~',
    'scope~',
    'selector~',
    'send~',
    'seq~',
    'sfinfo~',
    'sfizz~',
    'sflist~',
    'sfplay~',
    'sfrecord~',
    'shape~',
    'sig~',
    'sinh~',
    'sinx~',
    'slide~',
    'snapshot-group',
    'snapshot~',
    'snowfall~',
    'spectroscope~',
    'spike~',
    'sqrt~',
    'stash~',
    'stretch~',
    'stutter~',
    'subdiv~',
    'svf~',
    'swing~',
    'sync~',
    'table~',
    'tanh~',
    'tanx~',
    'tapin~',
    'tapout~',
    'techno~',
    'teeth~',
    'thispoly~',
    'thresh~',
    'times~',
    'train~',
    'trapezoid~',
    'triangle~',
    'tri~',
    'trunc~',
    'twist~',
    'typeroute~',
    'updown~',
    'vectral~',
    'vst~',
    'waveform~',
    'wave~',
    'what~',
    'where~',
    'windowed-fft~',
    'zerox~',
    'zigzag~',
    'zplane~',
]

JIT_REF_FILES = [
    'jit.3m',
    'jit.alphablend',
    'jit.altern',
    'jit.ameba',
    'jit.anim.drive',
    'jit.anim.node',
    'jit.anim.path',
    'jit.argb2ayuv',
    'jit.argb2grgb',
    'jit.argb2uyvy',
    'jit.avc',
    'jit.avg4',
    'jit.axis2quat',
    'jit.ayuv2argb',
    'jit.ayuv2luma',
    'jit.ayuv2uyvy',
    'jit.bfg',
    'jit.brass',
    'jit.brcosa',
    'jit.bsort',
    'jit.buffer~',
    'jit.catch~',
    'jit.change',
    'jit.charmap',
    'jit.chromakey',
    'jit.clip',
    'jit.coerce',
    'jit.colorspace',
    'jit.concat',
    'jit.convolve',
    'jit.conway',
    'jit.cycle',
    'jit.demultiplex',
    'jit.desktop',
    'jit.dimmap',
    'jit.dimop',
    'jit.displays',
    'jit.dx.grab',
    'jit.dx.videoout',
    'jit.eclipse',
    'jit.euler2quat',
    'jit.expr',
    'jit.fastblur',
    'jit.fft',
    'jit.fill',
    'jit.findbounds',
    'jit.fluoride',
    'jit.fprint',
    'jit.fpsgui',
    'jit.freeframe',
    'jit.gen.codebox',
    'jit.gen',
    'jit.gencoord',
    'jit.gl.asyncread',
    'jit.gl.bfg',
    'jit.gl.camera',
    'jit.gl.cornerpin',
    'jit.gl.cubemap',
    'jit.gl.graph',
    'jit.gl.gridshape',
    'jit.gl.handle',
    'jit.gl.isosurf',
    'jit.gl.light',
    'jit.gl.lua',
    'jit.gl.material',
    'jit.gl.mesh',
    'jit.gl.model',
    'jit.gl.multiple',
    'jit.gl.node',
    'jit.gl.nurbs',
    'jit.gl.pass',
    'jit.gl.path',
    'jit.gl.physdraw',
    'jit.gl.picker',
    'jit.gl.pix.codebox',
    'jit.gl.pix',
    'jit.gl.plato',
    'jit.gl.render',
    'jit.gl.shader',
    'jit.gl.sketch',
    'jit.gl.skybox',
    'jit.gl.slab',
    'jit.gl.text',
    'jit.gl.texture',
    'jit.gl.videoplane',
    'jit.gl.volume',
    'jit.glop',
    'jit.glue',
    'jit.grab',
    'jit.gradient',
    'jit.graph',
    'jit.grgb2argb',
    'jit.group-gl',
    'jit.group-mop',
    'jit.hatch',
    'jit.hello',
    'jit.histogram',
    'jit.hsl2rgb',
    'jit.hue',
    'jit.iter',
    'jit.keyscreen',
    'jit.la.determinant',
    'jit.la.diagproduct',
    'jit.la.inverse',
    'jit.la.mult',
    'jit.la.trace',
    'jit.la.uppertri',
    'jit.lcd',
    'jit.linden',
    'jit.luma2ayuv',
    'jit.luma2uyvy',
    'jit.lumakey',
    'jit.map',
    'jit.matrix',
    'jit.matrixinfo',
    'jit.matrixset',
    'jit.mgraphics',
    'jit.movie',
    'jit.multiplex',
    'jit.mxform2d',
    'jit.net.recv',
    'jit.net.send',
    'jit.noise',
    'jit.normalize',
    'jit.obref',
    'jit.op',
    'jit.openexr',
    'jit.p.bounds',
    'jit.p.shiva',
    'jit.p.vishnu',
    'jit.pack',
    'jit.path',
    'jit.peek~',
    'jit.phys.6dof',
    'jit.phys.barslide',
    'jit.phys.body',
    'jit.phys.conetwist',
    'jit.phys.ghost',
    'jit.phys.hinge',
    'jit.phys.multiple',
    'jit.phys.picker',
    'jit.phys.point2point',
    'jit.phys.world',
    'jit.pix.codebox',
    'jit.pix',
    'jit.planeop',
    'jit.playlist',
    'jit.plot',
    'jit.plume',
    'jit.plur',
    'jit.poke~',
    'jit.print',
    'jit.proxy',
    'jit.pwindow',
    'jit.pworld',
    'jit.qball',
    'jit.qfaker',
    'jit.qt.grab',
    'jit.qt.movie',
    'jit.qt.record',
    'jit.qt.videoout',
    'jit.quat',
    'jit.quat2axis',
    'jit.quat2euler',
    'jit.record',
    'jit.release~',
    'jit.repos',
    'jit.resamp',
    'jit.reverse',
    'jit.rgb2hsl',
    'jit.rgb2luma',
    'jit.robcross',
    'jit.rota',
    'jit.roy',
    'jit.rubix',
    'jit.scalebias',
    'jit.scanoffset',
    'jit.scanslide',
    'jit.scanwrap',
    'jit.scissors',
    'jit.scope',
    'jit.shade',
    'jit.slide',
    'jit.sobel',
    'jit.spill',
    'jit.split',
    'jit.sprinkle',
    'jit.str.fromsymbol',
    'jit.str.op',
    'jit.str.regexp',
    'jit.str.tosymbol',
    'jit.streak',
    'jit.submatrix',
    'jit.textfile',
    'jit.thin',
    'jit.tiffany',
    'jit.traffic',
    'jit.transpose',
    'jit.turtle',
    'jit.uldl',
    'jit.unpack',
    'jit.uyvy2argb',
    'jit.uyvy2ayuv',
    'jit.uyvy2luma',
    'jit.vcr',
    'jit.wake',
    'jit.window',
    'jit.world',
    'jit.xfade',
    'mc.jit.peek~',
]

M4L_REF_FILES = [
    'chucker~',
    'cverb~',
    'ddg.mono',
    'live.arrows',
    'live.banks',
    'live.button',
    'live.colors',
    'live.comment',
    'live.dial',
    'live.drop',
    'live.gain~',
    'live.grid',
    'live.line',
    'live.map',
    'live.menu',
    'live.meter~',
    'live.miditool.in',
    'live.miditool.out',
    'live.modulate~',
    'live.numbox',
    'live.object',
    'live.observer',
    'live.param~',
    'live.path',
    'live.remote~',
    'live.routing',
    'live.slider',
    'live.step',
    'live.tab',
    'live.text',
    'live.thisdevice',
    'live.toggle',
    'mc.live.gain~',
    'midiselect',
    'parameters',
    'paraminspector',
]


class MaxRefParser:
    def __init__(self, filename: str):
        self.filename = Path(filename)
        self.name = self.filename.name.replace('.maxref.xml','')
        self.root = self.load(self.filename)
        self.d = {
            'name': self.name,
            'methods': {},
            'attributes': {},
        }
    def parse(self):
        self.extract_methods()
        self.extract_attributes()

    def load(self, filename: Path):
        cleaned = self.clean_text(filename.read_text())
        return ElementTree.fromstring(cleaned)

    def clean_text(self, txt: str) -> str:
        backtick = '`'
        return (txt
            .replace('<m>', backtick)
            .replace('</m>', backtick)
            .replace('<i>', backtick)
            .replace('</i>', backtick)
            .replace('<o>',  backtick)
            .replace('</o>',  backtick)
            .replace('<at>', backtick)
            .replace('</at>', backtick)
            .replace('&quot;', backtick)
        )

    def extract_attributes(self):
        d = self.d['attributes']

        for a in self.root.iter():
            if a.tag == 'attribute':
                name = a.attrib['name']
                d[name] = dict(a.attrib)
                digest = a.findall('digest')
                if digest:
                    d[name]['digest'] = digest[0].text.strip()
                description = a.findall('description')
                if description:
                    d[name]['description'] = description[0].text.strip()

    def extract_methods(self):
        d = self.d['methods']

        for m in self.root.iter():
            if m.tag == 'method':
                name = m.attrib['name']
                d[name] = {}
                arglist = m.findall('arglist')
                if arglist:
                    d[name]['args'] = []
                    args = arglist[0].findall('arg')
                    for arg in args:
                        d[name]['args'].append(dict(arg.attrib))
                digest = m.findall('digest')
                if digest:
                    d[name]['digest'] = digest[0].text.strip()
                description = m.findall('description')
                if description:
                    d[name]['description'] = description[0].text.strip()


if __name__ == '__main__':
    from pprint import pprint
    p = MaxRefParser(JIT_REF / "jit.matrix.maxref.xml")
    p.parse()
    pprint(p.d)
